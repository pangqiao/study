《Linux内核分析》MOOC课程: http://mooc.study.163.com/course/USTC-1000029000

一、作业列表: 

第一课 http://blog.csdn.net/u013897534/article/details/55669138

第二课 http://blog.csdn.net/u013897534/article/details/60480955

第三课 http://www.jianshu.com/p/abd642754f7b

第四课 http://www.jianshu.com/p/850104f983d8

第五课 http://www.jianshu.com/p/13bc26fa9738

第六课 http://www.jianshu.com/p/cd6110439786

第七课 http://www.jianshu.com/p/7e0f9142512a

第八课 http://www.jianshu.com/p/c68de44edb98

二、对Linux系统的理解及学习Linux内核的心得

操作系统的主要功能就是为用户屏蔽硬件的操作细节, 帮助用户管理计算机系统的各种资源, 这样一来操作系统本身就需要拥有一定的特权来区别于用户应用程序, 这就是内核态和用户态的由来. 当然这个机制需要CPU的支持, X86系列处理器定义了R0 - R4四个特权级别, Linux中使用了其中的R0作为内核态, R4作为用户态. 

内核态与用户态使用了不同的地址空间, 他们通过系统调用的方式进行通讯. 在32位下进程空间是2^32=4GByte, 其中0-3G是用户空间, 3G-4G是内核空间. 首先, 这个4G空间对应的是虚拟内存空间的概念, 也就是说这个4G并不在物理内存中, 而是通过页面置换不断部分进入或移出物理内存(缺页异常机制), 而这个4G中, 内核空间的1G空间是所有的进程所共享的, 而其余3G是互不可见的. 这样的地址设置加上中断机制, 对于一个进程来说, 就相当于独占了这个计算机. 

RobertLove的书里说, CPU在任一时刻都处于下面三种状态中的一种: 

１、内核态, 运行于进程上下文, 内核代表进程运行于内核空间; 

２、内核态, 运行于中断上下文, 内核代表硬件运行于内核空间; 

３、用户态, 运行于用户空间. 

孟老师在课上将中断上下文的切换和进程上下文的切换称为操作系统的"两把宝剑", 内核态正是运行于这两种环境中执行对中断、异常和系统调用的处理. 我之前已经提到, 系统调用是这门课的重中之重, 从一开始, 老师就提到"计算机工作的三个法宝": 存储程序计算机、函数调用堆栈和中断机制, 系统调用也可以算是一种特殊的中断机制. 我们日常使用系统调用都是通过调用封装好的C标准库函数来间接调用系统调用服务例程. 这正是老师总结的"系统调用的三层皮": API xyz –> 中断向量system_call –> 中断服务程序sys_xyz. 这样就进入内核态, 运行于进程上下文. 

三、课程总结: 

1、 对于要研究Linux内核的人来说, X86汇编语言是你必须要面对的第一关, 因为操作系统需要大量对寄存器的操作, 这是体系结构相关的操作, 所以必须用汇编语言来解决, 这门课在一开始就讲解了X86汇编, 并在后面的课程中不断巩固, 这点对于阅读内核源码非常有用. 

2、 该课程用一个简单的演示内核myKernel来说明Linux是如何启动的, 包括一个进程是怎样描述的(PCB信息), 0号进程(idle)的创建与演化, 1号进程init的创建与加载, 2号进程kthreadd的创建等等. 这可以使我们从高处对Linux内核有个大概的认识, 并且课中手把手的源码阅读可以让人对减少对结构复杂的内核代码的恐惧. 

3、 我们日常使用内核, 其实大部分功能都是使用它的系统调用, 比如从创建一个新的进程fork, 装载程序execve, 到输入输出, 时间查询等等. 因此我们研究内核, 很大一部分都是在研究如何实现这些系统调用. 这门课在8周中花了两周时间来讲解系统调用在内核中是如何进行的. 如果把进程创建和可执行程序的装载也算作系统调用的讲解的话, 那实际上占了课程的一半. 所以课程的设置正体现了这些系统调用在内核构成中的重要性. 课中提供了一个试验环境MenuOS, 该系统实现了一个命令行菜单系统, 我们只需要添加我们希望执行的功能函数到菜单就OK了, 同时利用Qemu和gdb, 我们跟踪了各种系统调用的执行过程. 

4、 虽然这门课没有将具体的调度算法, 比如Linux内核中著名的完全公平队列CFS, 但对于进程调度来说, 除了调度算法, 还有两个重要问题, 那就是进程的调度时机与切换过程, 该课程花了一节课来讲解schedule()函数的实现. 

5、 我们不仅需要学习Linux内核的相关知识, 更需要学习正确的人生观和世界观, 这门课的精髓在于, 不仅教会你如何分析Linux内核, 更教你做事的方法论: "天下难事必做于易, 天下大事必做于细", 对于代码量庞大无从下手的内核, 我们从小处入手, 步步为营, 最终掌握全局. 
