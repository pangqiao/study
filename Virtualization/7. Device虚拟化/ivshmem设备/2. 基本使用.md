
https://www.qemu.org/docs/master/system/devices/ivshmem.html



> ./configure --enable-kvm --disable-xen --disable-strip --disable-sdl --enable-vhost-net --disable-debug-tcg --target-list=x86_64-softmmu

基本语法:

```
qemu-system-x86_64 -device ivshmem-plain,memdev=hostmem
```

`hostmem` 定义了一个 host 上的 memory backend. 对于一个 POSIX 共享内存后端, 类似:

```
-object memory-backend-file,size=1M,share=true,mem-path=/dev/shm/ivshmem,id=hostmem

-object memory-backend-file,size=1M,share,mem-path=/dev/shm/ivshmem,id=hostmem
```

内核模块和用户态程序:

https://github.com/haiwei-li/ivshmem_example

IVSHMEM 测试代码:

https://github.com/haiwei-li/ivshmem-code



qemu log(打开:

```cpp
IVSHMEM: using shared memory server (socket = unix:)
IVSHMEM: bumping storage to 16 peers
IVSHMEM: posn is -1, fd is 11
IVSHMEM: msix initialized (8 vectors)
IVSHMEM: posn is 0, fd is 12
IVSHMEM: eventfds[0][0] = 12
IVSHMEM: posn is 0, fd is 21
IVSHMEM: eventfds[0][1] = 21
IVSHMEM: posn is 0, fd is 22
IVSHMEM: eventfds[0][2] = 22
IVSHMEM: posn is 0, fd is 23
IVSHMEM: eventfds[0][3] = 23
IVSHMEM: posn is 0, fd is 24
IVSHMEM: eventfds[0][4] = 24
IVSHMEM: posn is 0, fd is 25
IVSHMEM: eventfds[0][5] = 25
IVSHMEM: posn is 0, fd is 26
IVSHMEM: eventfds[0][6] = 26
IVSHMEM: posn is 0, fd is 27
IVSHMEM: eventfds[0][7] = 27
IVSHMEM: posn is 2, fd is 28
IVSHMEM: eventfds[2][0] = 28
IVSHMEM: setting up interrupt for vector: 0
IVSHMEM: with irqfd, delayed until msix enabled
IVSHMEM: posn is 2, fd is 29
IVSHMEM: eventfds[2][1] = 29
IVSHMEM: setting up interrupt for vector: 1
IVSHMEM: with irqfd, delayed until msix enabled
IVSHMEM: posn is 2, fd is 30
IVSHMEM: eventfds[2][2] = 30
IVSHMEM: setting up interrupt for vector: 2
IVSHMEM: with irqfd, delayed until msix enabled
IVSHMEM: posn is 2, fd is 31
IVSHMEM: eventfds[2][3] = 31
IVSHMEM: setting up interrupt for vector: 3
IVSHMEM: with irqfd, delayed until msix enabled
IVSHMEM: posn is 2, fd is 32
IVSHMEM: eventfds[2][4] = 32
IVSHMEM: setting up interrupt for vector: 4
IVSHMEM: with irqfd, delayed until msix enabled
IVSHMEM: posn is 2, fd is 33
IVSHMEM: eventfds[2][5] = 33
IVSHMEM: setting up interrupt for vector: 5
IVSHMEM: with irqfd, delayed until msix enabled
IVSHMEM: posn is 2, fd is 34
IVSHMEM: eventfds[2][6] = 34
IVSHMEM: setting up interrupt for vector: 6
IVSHMEM: with irqfd, delayed until msix enabled
IVSHMEM: posn is 2, fd is 35
IVSHMEM: eventfds[2][7] = 35
IVSHMEM: setting up interrupt for vector: 7
IVSHMEM: with irqfd, delayed until msix enabled
```