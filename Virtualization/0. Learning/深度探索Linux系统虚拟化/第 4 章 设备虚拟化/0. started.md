
顾名思义, **设备虚拟化**就是系统虚拟化软件使用软件的方式呈现给 Guest 操作系统硬件设备的逻辑. 设备虚拟化先后经历了**完全虚拟化**、**半虚拟化**, 以及后来出现的**硬件辅助虚拟化**, 包括将**硬件直接透传**(passthrough)给虚拟机, 以及将**一个硬件**从**硬件层面**虚拟成**多个子硬件**, 每个子硬件分别透传给虚拟机等.

所谓的完全虚拟化, 就是按照硬件的规范, 完完整整地模拟硬件的逻辑. 这种方式对Guest是完全透明的, Guest操作系统无须做任何修改, 这些虚拟的设备对于Guest内核中的驱动来讲与真实驱动别无二致. 在本章中, 我们将通过一个简单的串口设备的虚拟化, 来展示设备完全虚拟化的原理.

由于完全虚拟化完完整整地模拟了硬件的逻辑, 因此它也是I/O虚拟化中性能最差的一种方案, 于是在软件层面, 人们提出了一种简化的标准Virtio. 在软件虚拟方案中, Virtio是性能非常好的一种方式, 因此也占据着主流, 我们将在“Virtio虚拟化”一章中完整地讨论Virtio虚拟化方案.

除了软件开发人员在软件层面的努力, 芯片厂商们在硬件层面也在进行不懈的努力, 其中典型的是Intel的VT-d技术. 最初, VT-d支持将整个设备透传给一台虚拟机, 但是这种方案无法在多虚拟机之间共享设备, 不具备可扩展性, 于是又演生出了SR-IOV方案. 在本章中, 我们将探讨SR-IOV虚拟化的原理.