
当驱动准备向设备传输数据时, 其首先将需要传输的数据组织到一个或者多个描述符链中, 每个描述符链可能包含一项或多项描述符. 每填充一个描述符链, 会将描述符链表中的第 1 项描述符的 ID 追加到可用描述符区域中的 ring 数组中. 

我们来简单回忆一下前面探讨的内核的 I/O 栈. 在 I/O 栈中, 通用块设备层将来自文件系统的 bio 组织到请求中, 然后I/O调度层负责将请求排入队列, 为了减少磁头的寻道次数, 其会按照电梯调度算法进行排队, 可能还伴随着 merge 等操作. 然后块设备驱动会处理请求队列中的请求, 对于 Virtio blk 来讲, 这个处理请求的函数是 `do_virtblk_request`, 对于真实的物理设备, 处理请求的函数将向物理设备发起 I/O 操作, 而对于使用 Virtio 协议的模拟设备, `do_virtblk_request` 的使命是将请求组织为可用描述符区域的一段可用描述符链: 

```cpp
commit e467cde238184d1b0923db2cd61ae1c5a6dc15aa
Block driver using virtio.
linux.git/drivers/block/virtio_blk.c
static int virtblk_probe(struct virtio_device *vdev)
{
    ...
    /* We expect one virtqueue, for output. */
    vblk->vq = vdev->config->find_vq(vdev, blk_done);
    ...
}
```