
本章介绍了嵌入式虚拟化实时场景中 ACRN 如何支持实时性及其调优. 结合 Intel 硬件平台和 ACRN 列出了可行的基本思路来进行实时性能优化, 从而可以使 RTVM 的实时性接近于物理机的实时性. 这些思路包括:

* 尽量减少由虚拟化环境带来的实时性能开销. 常见的优化方法有 CPU 分区, 中断直通, 设备直通等. 这些方法可以使 RTVM 运行时不需要陷入 Hypervisor 这一层, 从而避免 VM Exit 的产生, 进而提高 RTVM 的性能.

* 利用 CAT 可以避免多个 VM 系统间的访问缓存干扰. 在负载整合的环境下, 一个硬件平台要同时支持 RTVM 和非实时 VM(例如 HMI)​, 因此对缓存进行分区可以有效提高 RTVM 的指令读取缓存的命中率, 进而提高其确定性和实时性. Intel TCC 工具可以用来辅助优化实时性能.

* 除了从 ACRN Hypervisor 和硬件层次配置优化之外, 还需要从 RTVM 中来配合调优. 例如, 在实时任务运行的过程中避免执行一些特殊指令 (如 CPUID)​, 访问一些特殊 MSR 等, 可以用 VM Exit 辅助工具来分析这些场景, 从 RTVM 中来避免这种情况的发生.