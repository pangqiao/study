
QEMU自定义了一个新的事件源AioContext, 有两种类型的AioContext, 第一类用来监听各种各样的事件, 比如iohandler_ctx, 第二类是用来处理块设备层的异步I/O请求, 比如QEMU默认的qemu_aio_context或者模块自己创建的AioContext. 这里只关注第一种情况, 即事件相关的AioContext. 下面的代码列出了AioContext结构中的主要成员.

...




aio_dispatch_handlers函数会遍历 aio_handlers，遍历监听fd上的事件是否发生了。fd发生的事件存在node->pfd.revents中，注册时指定需要接受的事件存放在node->pfd.events中，revents变量保存了fd接收到的事件。对应 `G_IO_IN` **可读事件**来说，会调用注册的fd的io read回调，对 `G_IN_OUT` 可写事件来说，会调用注册的 fd 的 io_write 函数。当然，如果当前的fd已经删除了，则会删除这个节点。

